{# VxLAN Basic Configurtaion including Feratures Template #}

{# Enable Features multiCast and OSPF on all Spine & Leaf#}
feature ospf
feature pim
{% if host.dev_vars.spine == False %}
{# Enable VxLAN to create NVE interfac & VNI to VLAN mapping only at Leaf/VTEP#}
feature nv overlay
feature vn-segment-vlan-based
{# Create VLANs and map VNI to each VLAN if VLAN mapped to vni (only at Leaf/VTEP Devices) #}
{% for vlan in host.dev_vars.vlans %}
{# Create VLANs only of host exist for this specific VLAN or Trunk exist on VTEP Devices) #}
{% if vlan.host_exist == True or host.dev_vars.trunk_exist == True %}
vlan {{ vlan.vlan_id }}
{% if vlan.vxlan_support %}
vn-segment {{ vlan.vni }}
{% endif %}
{% endif %}
{# Configure access port/interface if host exist for particular vlan #}
{% if vlan.host_exist %}
{% for access_int in vlan.interfaces %}
interface {{ access_int }}
switchport
switchport mode access
switchport access vlan {{ vlan.vlan_id }} 
no shut
{% endfor %}
{% endif %}

{% endfor %}

{# Configure Trunk Interfcae if Leaf/VTEP connected with Router or any host running dot1q as access side on Leaf Devices #}
{% if host.dev_vars.trunk_exist %}
{% for trunk_int in host.dev_vars.trunk_interface %}
interface {{ trunk_int.name }}
switchport
switchport mode trunk
switchport trunk allowed vlan {{ trunk_int.allowed_vlan }} 
no shut
{% endfor %}
{% endif %}

{% endif %}





{# Enable Jumbo Frame on all Spine & Leaf, mtu size variy on diffrent platform#}
system jumbomtu {{ host.dev_vars.mtu }}

{# Enable Underlay OSPF process on all Spine & Leaf Devices #}
router ospf {{ host.dev_vars.ospf.proc_id }}
router-id {{ host.dev_vars.ospf.rid }}
